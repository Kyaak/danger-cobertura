[![Gem Version](https://badge.fury.io/rb/danger-cobertura.svg)](https://badge.fury.io/rb/danger-cobertura)
[![Build Status](https://travis-ci.org/Kyaak/danger-cobertura.svg?branch=master)](https://travis-ci.org/Kyaak/danger-cobertura)
[![Maintainability](https://api.codeclimate.com/v1/badges/2e657e2a49ddf9696ece/maintainability)](https://codeclimate.com/github/Kyaak/danger-cobertura/maintainability)
[![Test Coverage](https://api.codeclimate.com/v1/badges/2e657e2a49ddf9696ece/test_coverage)](https://codeclimate.com/github/Kyaak/danger-cobertura/test_coverage)
[![Inline docs](http://inch-ci.org/github/Kyaak/danger-cobertura.svg?branch=master)](http://inch-ci.org/github/Kyaak/danger-cobertura)


# danger-cobertura

A [cobertura](http://cobertura.github.io/cobertura/) report plugin for [danger](https://danger.systems/ruby).

This plugin allows parsing of an xml coverage report generated by __cobertura__ and displays desired metrics.

_It inspects only modified and added files, deleted ones are not considered useful for this report._

## How it looks like
### Warnings about file coverage
<table>
  <thead>
    <tr>
      <th width="50"></th>
      <th width="100%">
          1 Warnings
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><g-emoji alias="warning" fallback-src="https://assets-cdn.github.com/images/icons/emoji/unicode/26a0.png">⚠️</g-emoji></td>
      <td>example.py has less than 50% coverage</td>
    </tr>
  </tbody>
</table>

### Coverage report

File | Coverage
-----|-----
example_one.py | 50.00
example_two.py | 35.60
example_three.py | 10.48


## Installation

    $ gem install danger-cobertura

## Usage

    Methods and attributes from this plugin are available in
    your `Dangerfile` under the `cobertura` namespace.

<blockquote>Warn files with a coverage less than 50%
<pre>
cobertura.report = build/reports/coverage.xml
cobertura.warn_if_file_less_than(percentage: 50.0)
</pre>
</blockquote>    

<blockquote>Show coverage of all files 
<pre>
cobertura.report = build/reports/coverage.xml
cobertura.show_coverage
</pre>
</blockquote>   

<blockquote>Combine all reports 
<pre>
cobertura.report = build/reports/coverage.xml
cobertura.warn_if_file_less_than(percentage: 50.0)
cobertura.show_coverage
</pre>
</blockquote>  

## Attributes

__`report`__ - Path to the cobertura xml report, e.g. `build/reports/coverage.xml`

## Methods

__`warn_if_file_less_than(percentage:)`__ - Add a danger warning for each file with a lower total coverage as given.

__`show_coverage`__ - Show a markdown table including the coverage for all (modified / added) files.

## Development

1. Clone this repo
2. Run `bundle install` to setup dependencies.
3. Run `bundle exec rake spec` to run the tests.
4. Use `bundle exec guard` to automatically have tests run as you make changes.
5. Make your changes.
